---
types:
  int: &int INTEGER
  text: &text TEXT
  real: &real REAL
defaults:
  type: *text
functions:
  format: &format format

tables:
  - name: &S Sessions
    fields:
      - name: &S_ID SESSION_ID
        type: *int
        key: true
      - name: Start
      - name: End
      - name: Title
    queries:
      get_last_session:
        sql: SELECT SESSION_ID from Sessions ORDER BY SESSION_ID DESC LIMIT 1
    foreign_keys:
  - name: &TR TimeReference
    fields:
      - name: REF_TO_SESSION
        type: *int
      - name: &TR_ID TS_ID
        type: *int
        key: true
      - name: TimeStamp
    queries:
      get_last_entry:
        sql: select tr.TS_ID
             FROM TimeReference tr
             JOIN Sessions s ON tr.REF_TO_SESSION = s.SESSION_ID
             WHERE tr.REF_TO_SESSION = {}
             ORDER BY tr.TS_ID DESC LIMIT 1
        function: *format
    foreign_keys:
      REF_TO_SESSION:
        table: *S
        field: *S_ID
  - name: Lsof
    fields:
      - name: REF_TO_TS
        type: *int
      - name: program
      - name: count
        type: *int
    foreign_keys: &REF_TO_TR
      REF_TO_TS:
        table: *TR
        field: *TR_ID
  - name: NetstatNetworks
    fields:
      - name: REF_TO_TS
        type: *int
      - name: Proto
      - name: Recv_Q
        type: *int
      - name: Send_Q
        type: *int
      - name: LocalAddress
      - name: ForeignAddress
      - name: State
      - name: User
      - name: I_node
      - name: PID
      - name: ProgramName
    foreign_keys: *REF_TO_TR
  - name: NetstatSockets
    fields:
      - name: REF_TO_TS
        type: *int
      - name: Proto
      - name: RefCnt
        type: *int
      - name: Flags
      - name: Type
      - name: State
      - name: I_Node
        type: *real
      - name: PID
      - name: ProgramName
      - name: Path
    foreign_keys: *REF_TO_TR
  - name: TopHeader
    fields:
      - name: REF_TO_TS
        type: *int
      - name: Tasks_Total
        type: *real
      - name: Tasks_Running
        type: *real
      - name: Tasks_Sleep
        type: *real
      - name: Tasks_Stopped
        type: *real
      - name: Tasks_Zombie
        type: *real
      - name: CPU_Used
        type: *real
      - name: CPU_System
        type: *real
      - name: CPU_Nicer
        type: *real
      - name: CPU_Idle
        type: *real
      - name: CPU_Wait
        type: *real
      - name: CPU_HInterrupt
        type: *real
      - name: CPU_SInterrupt
        type: *real
      - name: CPU_Steal
        type: *real
      - name: Memory_Total
        type: *real
      - name: Memory_Free
        type: *real
      - name: Memory_Used
        type: *real
      - name: Memory_Buffer
        type: *real
      - name: SWAP_Free
        type: *real
      - name: SWAP_Total
        type: *real
      - name: SWAP_Used
        type: *real
      - name: SWAP_Available
        type: *real
    foreign_keys: *REF_TO_TR
  - name: TopProcesses
    fields:
      - name: REF_TO_TS
        type: *int
      - name: PID
        type: *int
      - name: USER
      - name: PR
      - name: NI
        type: *int
      - name: VIRT
        type: *real
      - name: RES
        type: *real
      - name: SHR
        type: *real
      - name: S
      - name: CPU
      - name: MEM
        type: *real
      - name: TIME
      - name: COMMAND
      - name: NAME
    foreign_keys: *REF_TO_TR
  - name: CustomCommand
    fields:
      - name: REF_TO_TS
        type: *int
      - name: Command
      - name: Exit_Criteria
      - name: Status
      - name: Rc
      - name: Output
    foreign_keys: *REF_TO_TR
  - name: MarkPoints
    fields:
      - name: REF_TO_TS
        type: *int
      - name: Reason
    queries:
      select_mark:
        sql: SELECT t.TimeStamp
             FROM MarkPoints m
             JOIN TimeReference t ON t.TS_ID = m.REF_TO_TS
             WHERE m.Reason = "{}"
        function: *format
      get_marks:
        sql: SELECT m.Reason as Reason, t.TimeStamp as Time
             FROM MarkPoints m
             JOIN TimeReference t ON t.TS_ID = m.REF_TO_TS
             JOIN Sessions s ON s.SESSION_ID = t.REF_TO_SESSION
             WHERE s.Title = "{}"
        function: *format
    foreign_keys: *REF_TO_TR
  - name: aTopSystemLevel
    fields:
      - name: REF_TO_TS
        type: *int
      - name: Type
      - name: DataMap
      - name: Col1
        type: *real
      - name: Col2
        type: *real
      - name: Col3
        type: *real
      - name: Col4
        type: *real
      - name: Col5
        type: *real
      - name: SUB_ID
    foreign_keys: *REF_TO_TR

